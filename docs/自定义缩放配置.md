本文档指导您如何定义自己的缩放模式。

Magpie启动时会在所在目录搜索配置文件 —— **ScaleModels.json** ，如果未找到则会使用程序内置的默认参数自动生成该文件。  
原始配置文件的完整内容 [点此查看](https://github.com/Blinue/Magpie/blob/main/Magpie/Resources/BuiltInScaleModels.json) ，以下为语法格式示例：

```json
[
  {
    "name": "Lanczos",
    "effects": [
      {
        "effect": "Lanczos",
        "scale": [ -1, -1 ]
      },
      {
        "effect": "AdaptiveSharpen",
        "curveHeight": 0.3
      }
    ]
  },
  {
    "name": "FSR",
    "effects": [
      {
        "effect": "FSR_EASU",
        "scale": [ -1, -1 ]
      },
      {
        "effect": "FSR_RCAS",
        "sharpness": 0.87
      }
    ]
  },
  {
    "...": "..."
  }
]
```

配置文件的根元素是一个数组，其中的每个成员都是一个“缩放模式”。缩放模式由一系列的效果（Effect）堆叠而成，Magpie 在缩放时会逐个应用这些效果。

Magpie 内置了大量效果供组合使用，大部分提供了参数选项以订制行为。所有效果存储在 effects 文件夹中，如果你了解 HLSL，你可以很容易的添加任何你想要的效果，见[自定义效果](https://github.com/Blinue/Magpie/wiki/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%88%E6%9E%9C%EF%BC%88MagpieFX%EF%BC%89)。

很多效果支持 scale 参数，它的值必须是有两个元素的数组。当它们为正数时，表示长和高的缩放比例；为负数时则表示相对于屏幕能容纳的最大等比缩放的比例；为 0 时表示缩放到充满屏幕（画面可能会被拉伸）。所有 scale 参数的默认值为 [1,1]，即和输入尺寸相同。在 [示例](#示例) 中可以看到它们的应用。

## 内置效果介绍

* ACNet：[ACNetGLSL](https://github.com/TianZerL/ACNetGLSL) 的移植。适合动画风格图像的缩放，有较强的降噪效果
  * 输出尺寸：输入的两倍

* AdaptiveSharpen：自适应锐化算法。此算法着重于锐化图像中的模糊边缘，因此相比一般的锐化算法噪点、振铃和条纹更少。
  * 输出尺寸：和输入相同
  * 参数
    * curveHeight：锐化强度。必须大于零，一般在0.3~2.0之间。默认值为 1.0。

* Anime4K_3D_AA_Upscale_US 和 Anime4K_3D_Upscale_US：Anime4K 提供的 3D 游戏画面缩放算法。AA 变体有抗锯齿的功能。
  * 输出尺寸：输入的两倍

* Anime4K_Denoise_Bilateral_Mean、Anime4K_Denoise_Bilateral_Median 和 Anime4K_Denoise_Bilateral_Mode：Anime4K 提供的降噪算法，分别使用平均数、中位数和众数
  * 输出尺寸：和输入相同
  * 参数
    * intensitySigma：降噪强度。必须大于零。默认值为0.1。

* Anime4K_Restore_M、Anime4K_Restore_L 和 Anime4K_Restore_VL：Anime4K 提供的用于还原动漫画面线条的算法，对性能的需求依次提高
  * 输出尺寸：和输入相同

* Anime4K_Upscale_S、Anime4K_Upscale_L、Anime4K_Upscale_Denoise_S 和 Anime4K_Upscale_Denoise_L：Anime4K 提供的动画风格图像缩放算法。Denoise 变体包含降噪效果
  * 输出尺寸：输入的两倍

* Anime4K_Upscale_S_Lite：Anime4K_Upscale_S 的轻量版本。速度更快，但可能有质量损失。适合显卡性能不足的用户。
  * 输出尺寸：输入的两倍

* CAS：[FidelityFX-CAS](https://github.com/GPUOpen-Effects/FidelityFX-CAS) 的移植。轻量级的锐化效果
  * 输出尺寸：和输入相同
  * 参数
    * sharpness：必须在0-1之间。默认值为0.4。

* FSR_EASU：[FidelityFX-FSR](https://github.com/GPUOpen-Effects/FidelityFX-FSR) 中缩放步骤的移植
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例
* FSR_RCAS：[FidelityFX-FSR](https://github.com/GPUOpen-Effects/FidelityFX-FSR) 中锐化步骤的移植
  * 输出尺寸：和输入相同
  * 参数
    * sharpness：锐化强度。值必须大于0，值越大图像越锐利。默认值为 0.87。

* FSRCNNX：FSRCNNX_x2_8-0-4-1 的移植
  * 输出尺寸：输入的两倍

* FSRCNNX_LineArt：FSRCNNX_x2_8-0-4-1_LineArt 的移植
  * 输出尺寸：输入的两倍

* FXAA_Medium、FXAA_High 和 FXAA_Ultra：快速近似抗锯齿。对性能的要求依次提高
   * 输出尺寸：和输入相同

* Jinc：使用 Jinc 算法缩放输入
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例
    * windowSinc：值越小图像越锐利。必须大于 0，默认值为 0.5
    * sinc：值越大图像越锐利。必须大于 0，默认值为 0.825

* Lanczos：使用 Lanczos 算法缩放输入。
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例
    * ARStrength：抗震铃强度。值越大抗震铃效果越好，但图像越模糊。必须在0到1之间。默认值为0.5。

* Linear：双线性插值
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

* Mitchell 和 Mitchell_Lite：使用 Mitchell-Netravali 算法缩放输入。用于缩小时效果最佳。Lite 变体速度更快，但可能有质量损失，适合显卡性能不足的用户
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例，值必须是有两个元素的数组。
    * variant：指定使用的变体
      * 0：默认值
      * 1：Catrom，比 mitchell 更锐利
      * 2：Sharper，更为锐利，可能有更好的视觉效果。Photoshop 使用此参数

* Nearest：最近邻插值
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

* Pixellate：使用 Pixellate 算法缩放输入。适合放大像素画
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

* RAVU_Lite_R3：ravu-lite-r3的移植
  * 输出尺寸：输入的两倍

* RAVU_Zoom_R3：ravu-zoom-r3的移植
  * 输出尺寸：取决于 scale 参数
   * 参数
     * scale：缩放比例

* SharpBilinear：使用 Sharp-Bilinear 算法缩放输入。适合放大像素画
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

* SMAA_Low、SMAA_Medium、SMAA_High 和 SMAA_Ultra：SMAA 抗锯齿算法。对性能的要求依次提高
   * 输出尺寸：和输入相同

* SSimDownscaler：基于感知的图像缩小算法，比 Catrom 更锐利
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

* xBRZ_2x、xBRZ_3x、xBRZ_4x、xBRZ_5x 和 xBRZ_6x：使用 xBRZ 算法缩放输入。适合放大像素画
  * 输出尺寸：取决于变体。放大到输入的 2-6 倍

* xBRZ_Freescale 和 xBRZ_Freescale_Multipass：支持任意缩放倍数的 xBRZ 算法
  * 输出尺寸：取决于 scale 参数
  * 参数
    * scale：缩放比例

## 示例

1. 如果屏幕大小是源窗口的 2-4 倍，可以应用两次 Anime4K，下面的片段演示了这个算法。

    ```json
    {
        "name": "动漫 4x",
        "effects": [
          {
            "effect": "Anime4K_Upscale_Denoise_L"
          },
          {
            "effect": "Mitchell",
            "scale": [ -0.5, -0.5 ],
            "variant": 1
          },
          {
            "effect": "Anime4K_Upscale_L"
          }
        ]
    }
    ```

    为了提升性能，在应用第一次 Anime4K 后缩放到屏幕能容纳的最大等比缩放的比例的一半大小，这样在第二次应用 Anime4K 后刚好全屏显示。为了消除图像中的轻微噪点，第一次使用的 Anime4K 为降噪版本。

2. 将捕获的窗口输出至画面居中位置（四周黑边）

    ```json
    {
        "name": "Source",
        "effects": [
          {
            "effect": "Nearest"
          }
        ]
    }
    ```

👉 [更多示例](https://gist.github.com/hooke007/818ecc88f18e229bca743b7ae48947ad)
